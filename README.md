# 通用平台数据导入使用手册

| 文档创建日期     | 版本号  | 文档说明            | 创建人 |
|:----------:|:----:|:---------------:|:---:|
| 2018/12/31 | V3.0 | 通用平台数据导入网页版使用手册 | 陈斌  |

## 1. 介绍

 开发了一个新版本的数据导入，可部署到不同的平台上嵌入使用，也可以成为一个独立系统单独部署使用；通用的含义，即不管部署到哪个平台上，使用人员不需要关乎模板的问题，这些模板都是通用模板，没有修改的地方，只需要使用正确的模板，填写数据，导入即可。

以前的数据导入都需要手动添加POI写一个导入功能，每个项目都需要导入时就变成了每个项目都有导入功能，重复制造轮子，并且不灵活，模板是固定死的，当不满足时要在代码里修改逻辑并且重新打包部署，重复劳动。

网页版数据导入的诞生就是优化工作流程，不需要每个项目写一个导入的接口以及工具类，一个独立系统，在网页上操作，当不满足模板时，在网页中修改模板即可。

## 2. 特点

1. 自定义模板

   当模板不满足需求时，可以自定义模板，在模板数据页面，重新定义一个模板来导入，相比较老版本灵活性提高

2. 连接任何开放远程连接的数据库

   即为通用平台，部署到不同的平台都需要连接不同的数据库，在模板定义时，可以选择当前平台的数据库地址连接，导入不同数据库中

3. 灵活填写需要导入的字段

   在定义模板时，有填写需要插入到数据库表的字段以及填写excel文件的表头列，单个数据导入时，如河流，数据库中非必填的字段可以不需要在excel中出现

4. 数据效验器

   严格对excel中填写的数据进行效验正确性，如非空，长度，手机号码等，数据不正确则不允许导入到数据库中

5. 数据转换器

   到excel中某一列单元格的中文数值是对应数据库表中的字母或者数字时，转换器能够动态的将这些变化成数据库想要的字段，如区域等级，县级，经过转换器后存入数据库为3

6. 默认值以及缺省值

   每张数据库表中都有非空字段，但是都是在excel中无法填写的时候，如创建时间，填报时间，排序等，无需再excel中填写，默认值会为excel做充足的准备；缺省值则是在excel某一列数据为空时，在导入数据库时会自动填充

7. 导入器

   导入器共有三种，如需要，可扩展，一种是默认导入器：为1-3个数据库表数据做的工具，可导入单个数据；一种是多关联导入器：默认导入器是有限制只能满足三个数据库表关系，多关联导入器则突破了这个限制；

## 3. 使用流程

### 3.1 新建模板

若找不到想要的excel模板，在`模板数据`页面可以新增一个模板，根据输入框中提示的内容，一步步正确填写

![5c29ed0d65462](https://i.loli.net/2018/12/31/5c29ed0d65462.jpg)

提示数据库连接成功后，点击`保存配置`按钮

### 3.2 选择导入的表

点击保存后页面会引导进入选择要导入的SQL表有哪些，这里需要根据需求选择导入器，导入器说明在**特点**中已经描述，如要导入河流数据，选择河流数据库表，主键生成方式根据当前选择的SQL表主键规则来选择

![5c29ee02ceb1e](https://i.loli.net/2018/12/31/5c29ee02ceb1e.png)

### 3.3 选择要导入到数据库表的字段

这里是需要注意的地方，要查看数据库表哪些字段是非空的，就必选，要是忘记，点击保存时页面中会有提示，如若导入字段可空，excel中又不需要，在这里不需要定义

举例，以上选择了河流数据库表，要导入河流信息的字段如下（根据个人定义，当前是举例）；生成方式有四种选择，一种是excel：选择为excel的话，会出现在接下来生成的excel模板里，成为一列的标题；一种是外键关联：外键关联的含义是多张数据库表一起选择的时候，A表的ID是B表的其中一个数据库字段时需要使用到外键关联；一种是默认值：选择默认值，边上`默认值`这一个输入框会被打开，如图，河流类型这一列我不需要excel填写，默认值填写为“A”，那导入到数据库表里时，这一列会默认全部为A；一种是生成器：当某个字段excel中无法满足时，可以使用，如登录用户，排序等

![5c29ef2dec22c](https://i.loli.net/2018/12/31/5c29ef2dec22c.png)

### 3.4 定义excel模板的列标题

点击保存按钮，完成选择导入字段后，跳转到excel字段页面，在这里可以填写要定义的excel列名，如excel第一行第一列，我要导出成模板时，要它显示的是`河流名称`四个字，就写上这四个字

随后点击`对应数据库字段`，会有一个弹框，弹框中的内容，就是在导入字段中保存下的内容，要与excel的列名所对应，如river_name对应的是河流名称

缺省值、效验方法以及转换方法在**特点**中已描述其作用，例如河流名称excel这一列不为空，在效验方法弹框中勾选非空效验，错误与警告的含义在于，一个，出错回显到页面，一个提示但能导入，转换方法同例

![5c29f0fe8eca0](https://i.loli.net/2018/12/31/5c29f0fe8eca0.png)

![5c29f29b1c5c5](https://i.loli.net/2018/12/31/5c29f29b1c5c5.png)

### 3.5 下载模板

在`数据导入`页面，可以下载刚定义好的模板或者已经存在的模板

![5c29f30c3aad4](https://i.loli.net/2018/12/31/5c29f30c3aad4.png)

![5c29f38860014](https://i.loli.net/2018/12/31/5c29f38860014.png)

### 3.6 导入模板

数据填写完毕，再回到这个页面，选择好模板名称，选择填写好的模板，点击导入即可，如若数据错误，将在页面中提示当前哪一行的数据出现了错误

1. 某某值不能为空

   excel中红色必填项不能为空

在页面回显错误信息后，有操作按钮，点击弹框，不必修改excel，直接在弹框中对应的输入框里纠正，重新对单行进行效验，当错误信息显示无时，左上角点击保存数据按钮，即可导入数据库

![5c29fb37ac09b](https://i.loli.net/2018/12/31/5c29fb37ac09b.png)

![5c29fb45156c5](https://i.loli.net/2018/12/31/5c29fb45156c5.png)

## 4. 其他注意事项

转换器、效验器、生成器现在是基础的几个实现，不满足需求时，可继承相关接口，自行扩展，实现逻辑，在网页版中新增模板工具即可。
